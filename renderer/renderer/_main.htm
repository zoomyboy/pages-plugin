<?php foreach($markup->sections as $section): ?>
    <?php echo $section->openTag(); ?>

        <?php if ($section->isSidebarPosition('left')): ?>
            <div class="pr-10 w-1/4 flex-none">
                <div class="sticky top-10">
                    <?php foreach($section->sidebarModules() as $index => $module): ?>
                    <div class="bg-white shadow-lg p-3">
                        <div class="text-gray-700 font-arvo mb-3"><?php echo $module->title(); ?></div>
                        <div>
                            <?php echo $this->makePartial('modules/'.$module->getPartial(), ['module' => $module]); ?>
                        </div>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        <?php endif; ?>

        <?php if ($section->hasSidebar()): ?>
            <div class="flex-grow">
        <?php endif; ?>

            <?php foreach ($section->rows() as $ri => $row): ?>
                <?php $rowMarginTop = $ri != 0 && $section->meta()->type == 'fullwidth' ? 'mt-10 pt-10' : ''; ?>
                <?php $rowMarginTop = $ri != 0 && $section->meta()->type == 'fullwidth' ? 'mt-10 pt-10' : ''; ?>
                <?php $id = $section->isFullwidth() || $ri !== 0 ? str_slug($row->meta->title) : null; ?>
                <div class="<?php echo $rowMarginTop; ?>" <?php if($id): ?> id="<?= $id ?>" <?php endif; ?>>
                    <?php foreach ($row->columns as $ci => $column): ?>
                        <div class="w-<?php echo $column->width; ?>">
                            <?php foreach ($column->modules as $mi => $module): ?>
                            <?php echo $this->makePartial($module->is->type, ['module' => $module, 'section' => $section, 'params' => $params, 'before' => array_get($column->modules, $mi-1, null)]); ?>
                            <?php endforeach; ?>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php endforeach; ?>

        <?php if ($section->hasSidebar()): ?>
            </div>
        <?php endif; ?>

        <?php if ($section->isSidebarPosition('right')): ?>
            <div class="pl-10 w-1/4 flex-none">
                <div class="sticky top-10">
                    <?php foreach($section->sidebarModules() as $index => $module): ?>
                    <div class="bg-white shadow-lg p-3">
                        <div class="text-gray-700 font-arvo mb-3"><?php echo $module->title(); ?></div>
                        <div>
                            <?php echo $this->makePartial('modules/'.$module->getPartial(), ['module' => $module]); ?>
                        </div>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        <?php endif; ?>

    <?php echo $section->closingTag(); ?>
<?php endforeach; ?>
